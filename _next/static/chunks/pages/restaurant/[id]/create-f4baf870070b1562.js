(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[251],{3545:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/restaurant/[id]/create",function(){return r(9104)}])},5572:function(e,t,r){"use strict";var n=r(4051),u=r.n(n),a=r(7294),o=r(7633),i=r(4193),l=r(963),c=r(1912);function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function f(e,t,r,n,u,a,o){try{var i=e[a](o),l=i.value}catch(c){return void r(c)}i.done?t(l):Promise.resolve(l).then(n,u)}function d(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,u,a=[],o=!0,i=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);o=!0);}catch(l){i=!0,u=l}finally{try{o||null==r.return||r.return()}finally{if(i)throw u}}return a}}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return s(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return s(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}t.Z=function(e){var t=e.documentReference,r=e.path,n=e.pathSegments,s=void 0===n?c.uT:n,m=(0,i.Z)(),p=m.isLoadingHandler,v=m.isLoading,h=m.error,y=m.setError;a.useState(!1);var b=d(a.useState(void 0),2),x=b[0],g=b[1],w=a.useMemo((function(){return(0,c.wA)(x)}),[x]),j=a.useCallback((function(e){(function(){var n,a=(n=u().mark((function n(){var a,i;return u().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return y(void 0),g(void 0),n.prev=2,n.next=5,(0,o.Z)({documentReference:t,path:r,pathSegments:s});case 5:a=n.sent,g(a),n.next=13;break;case 9:n.prev=9,n.t0=n.catch(2),u=n.t0,l=Error,i=(null!=l&&"undefined"!==typeof Symbol&&l[Symbol.hasInstance]?l[Symbol.hasInstance](u):u instanceof l)?n.t0:new Error("getDocuments Error"),y(i);case 13:e();case 14:case"end":return n.stop()}var u,l}),n,null,[[2,9]])})),function(){var e=this,t=arguments;return new Promise((function(r,u){var a=n.apply(e,t);function o(e){f(a,r,u,o,i,"next",e)}function i(e){f(a,r,u,o,i,"throw",e)}o(void 0)}))});return function(){return a.apply(this,arguments)}})()()}),[t,r,s,y]),I=a.useCallback((function(){p(j)}),[p,j]);return{isInit:(0,l.Z)(I).isInit,isLoading:v,isLoadingHandler:p,error:h,getDocument:I,document:x,data:w}}},963:function(e,t,r){"use strict";var n=r(7294);function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,u,a=[],o=!0,i=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);o=!0);}catch(l){i=!0,u=l}finally{try{o||null==r.return||r.return()}finally{if(i)throw u}}return a}}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return u(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return u(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}t.Z=function(e){var t=a(n.useState(!0),2),r=t[0],u=t[1];return n.useEffect((function(){r&&(u(!1),null===e||void 0===e||e())}),[r,e]),{isInit:r,setIsInit:u}}},4193:function(e,t,r){"use strict";r.d(t,{Z:function(){return c}});var n=r(1030),u=r(7294);function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,u,a=[],o=!0,i=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);o=!0);}catch(l){i=!0,u=l}finally{try{o||null==r.return||r.return()}finally{if(i)throw u}}return a}}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return a(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var i=function(){var e=o(u.useState(void 0),2);return{error:e[0],setError:e[1]}};function l(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var c=function(){return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){l(e,t,r[t])}))}return e}({},(0,n.Z)(),i())}},9104:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return M}});var n,u=r(5893),a=r(7294),o=r(1163),i=r(2265),l=r(9726),c=r(4051),s=r.n(c),f=r(4184),d=r.n(f),m=r(4231),p=r(2175),v=r(8973),h=r(9151),y=r(1242);!function(e){e.HIDDEN="hidden",e.NAME="name",e.COST="cost",e.TYPE="type"}(n||(n={}));var b=r(1912);function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function g(e,t,r,n,u,a,o){try{var i=e[a](o),l=i.value}catch(c){return void r(c)}i.done?t(l):Promise.resolve(l).then(n,u)}function w(e){return function(){var t=this,r=arguments;return new Promise((function(n,u){var a=e.apply(t,r);function o(e){g(a,n,u,o,i,"next",e)}function i(e){g(a,n,u,o,i,"throw",e)}o(void 0)}))}}function j(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function I(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){j(e,t,r[t])}))}return e}function S(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,u,a=[],o=!0,i=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);o=!0);}catch(l){i=!0,u=l}finally{try{o||null==r.return||r.return()}finally{if(i)throw u}}return a}}(e,t)||O(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function A(e){return function(e){if(Array.isArray(e))return x(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||O(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function O(e,t){if(e){if("string"===typeof e)return x(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?x(e,t):void 0}}var E,T=function(e,t){return"restaurant-create-input-".concat(e,"-").concat(t)},k={hidden:"false",name:"",cost:0,type:""},N=[{supportText:n.NAME,type:"text",label:"\u540d\u7a31*",placeholder:"\u540d\u7a31 (string)"},{supportText:n.COST,type:"number",label:"\u50f9\u683c*",placeholder:"\u50f9\u683c*"},{supportText:n.TYPE,type:"text",label:"\u985e\u5225*",placeholder:"\u985e\u5225 (string)"}],P={menuItems:[k,k,k]},C=m.Ry().shape({menuItems:m.IX().of(m.Ry().shape((E={},j(E,n.HIDDEN,m.O7()),j(E,n.NAME,m.Z_().required("\u672c\u6b04\u4f4d\u70ba\u5fc5\u586b")),j(E,n.COST,m.Rx().integer("\u8acb\u8f38\u5165\u6574\u6578").min(10,"\u81f3\u5c1110\u5143").max(150,"\u4e0d\u53ef\u8d85\u904e150\u5143").required("\u672c\u6b04\u4f4d\u70ba\u5fc5\u586b")),j(E,n.TYPE,m.Z_()),E))).required("Required")}).required("Required"),_=function(e){var t=e.restaurantDoc,r=S(a.useState(!1),2),n=r[0],o=r[1],i=S(a.useState(""),2),l=i[0],c=i[1],f=a.useCallback((function(e,r,n){(function(){var u=w(s().mark((function u(){var a,i,l,f,d;return s().wrap((function(u){for(;;)switch(u.prev=u.next){case 0:return o(!0),u.prev=1,a=e.menuItems.map((function(e){return I({},e,{hidden:"true"===e.hidden})})),u.next=5,Promise.all(a.map(function(){var e=w(s().mark((function e(r){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,v.Z)({documentReference:t.ref,path:"menuItems/"+r.name,data:r});case 3:return e.abrupt("return",{status:"fulfilled",name:r.name});case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",{status:"rejected",name:r.name});case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}()));case 5:return i=u.sent,l="success",(f=i.reduce((function(e,t){return"fulfilled"===t.status?e:e===l?"fail with: "+t.name:e+", "+t.name}),l))===l?r.resetForm():(d=e.menuItems.reduce((function(e,t,r){return"fulfilled"===i[r].status?e:A(e).concat([t])}),Array()),r.setFieldValue("menuItems",d,!1)),c(f),u.next=12,(0,b._v)(1e3);case 12:c(""),o(!1),n(),u.next=25;break;case 17:return u.prev=17,u.t0=u.catch(1),c("Login failed"),u.next=22,(0,b._v)(2e3);case 22:c(""),o(!1),n();case 25:case"end":return u.stop()}}),u,null,[[1,17]])})));return function(){return u.apply(this,arguments)}})()()}),[t]),m=a.useCallback((function(e,t){n||(o(!0),f(e,t,(function(){o(!1)})))}),[n,f]),x=(0,p.TA)({enableReinitialize:!0,initialValues:P,validationSchema:C,onSubmit:m}),g=a.useMemo((function(){return 0!==Object.keys(x.errors).length}),[x.errors]);return(0,u.jsx)("div",{children:(0,u.jsxs)("form",{className:"mb-4 rounded bg-white px-8 pt-6 pb-8 shadow-md",onSubmit:x.handleSubmit,children:[(0,u.jsx)("div",{children:(0,u.jsx)("div",{className:"flex-1 md:pr-3",children:x.values.menuItems.map((function(e,t){var r=T(t,"hidden");return(0,u.jsxs)("div",{className:"flex flex-row items-center",children:[(0,u.jsxs)("label",{className:"mr-2 flex flex-row items-center",children:[(0,u.jsx)("input",{name:r,type:"checkbox",onChange:function(){var r=A(x.values.menuItems);r[t]=I({},e,{hidden:(0,b.sE)(e.hidden)}),x.setFieldValue("menuItems",r,!1)},checked:"true"===e.hidden}),(0,u.jsx)("div",{className:"pl-2 text-gray-600",children:"\u662f\u5426\u96b1\u85cf"})]}),N.map((function(r,n){var a,o,i,l,c;return(0,u.jsx)(h.Z,{inputProps:{id:T(t,r.supportText),name:T(t,r.supportText),placeholder:r.placeholder,type:r.type,onChange:function(n){var u=A(x.values.menuItems);u[t]=I({},e,j({},r.supportText,n.target.value)),x.setFieldValue("menuItems",u,!0)},value:null===(a=x.values.menuItems[t])||void 0===a?void 0:a[r.supportText]},label:r.label,showError:!!(null===(o=x.errors.menuItems)||void 0===o||null===(i=o[t])||void 0===i?void 0:i[r.supportText]),errorString:null===(l=x.errors.menuItems)||void 0===l||null===(c=l[t])||void 0===c?void 0:c[r.supportText]},"mnuItemInput-".concat(t,"-").concat(n))})),(0,u.jsx)("div",{className:"justfy-center mr-2 mb-2 flex h-10 w-10",children:t>0&&(0,u.jsx)("div",{className:d()("ml-2 flex h-10 w-10 items-center justify-center bg-blue-600 text-white",x.values.menuItems.length>9&&"bg-gray-700"),onClick:function(){x.setFieldValue("menuItems",A(x.values.menuItems.slice(0,t)).concat(A(x.values.menuItems.slice(t+1))),!0)},children:"-"})})]},"restaurant-create-input-".concat(t))}))})}),(0,u.jsxs)("div",{className:"flex flex-row",children:[(0,u.jsx)("div",{className:d()("mr-4 flex h-10 w-10 items-center justify-center bg-blue-600 text-white",x.values.menuItems.length>9&&"bg-gray-700"),onClick:function(){x.setFieldValue("menuItems",A(x.values.menuItems).concat([k]),!0)},children:"+"}),(0,u.jsxs)("div",{children:[(0,u.jsx)(y.Z,{disabled:n||g,type:"submit",children:"\u78ba\u8a8d\u9001\u51fa"}),l&&(0,u.jsx)("p",{children:l})]})]})]})})},Z=r(5572),D=function(e){var t=e.id,r=a.useMemo((function(){return[(0,b.W$)(t)]}),[t]),n=(0,Z.Z)({path:"restaurants",pathSegments:r}),o=n.isInit,i=n.isLoading,l=n.document;return o||i?(0,u.jsx)("div",{children:"restaurant list loading..."}):l?(0,u.jsx)(_,{restaurantDoc:l}):(0,u.jsx)("div",{children:"restaurant not found"})},M=function(){var e=(0,o.useRouter)().query.id,t=(0,l.Z)().isCanWriteFireStoreEmailUser;return(0,u.jsx)(i.Z,{children:t?(0,u.jsx)(D,{id:e}):(0,u.jsx)("div",{children:"???"})})}},1163:function(e,t,r){e.exports=r(387)}},function(e){e.O(0,[890,265,774,888,179],(function(){return t=3545,e(e.s=t);var t}));var t=e.O();_N_E=t}]);